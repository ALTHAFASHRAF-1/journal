<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Academic Research Journal - Peer-reviewed scholarly publications across multiple disciplines">
    <meta name="keywords" content="academic journal, research papers, scholarly articles, peer review, scientific publications">
    <meta name="author" content="Academic Research Journal">
    <title>Islamic Insight - All Issues</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
<style>
body {
font-family: 'Inter', sans-serif;
line-height: 1.6;
color: #1a202c;
}

.academic-title {
font-family: 'Crimson Text', serif;
}

.article-content h1, .article-content h2, .article-content h3 {
font-family: 'Crimson Text', serif;
font-weight: 600;
}

.article-content p {
margin-bottom: 1rem;
text-align: justify;
line-height: 1.7;
}

.article-content h2 {
margin-top: 2rem;
margin-bottom: 1rem;
font-size: 1.5rem;
color: #2d3748;
}

.article-content h3 {
margin-top: 1.5rem;
margin-bottom: 0.75rem;
font-size: 1.25rem;
color: #4a5568;
}

.citation-box {
background: #f7fafc;
border-left: 4px solid #4299e1;
padding: 1rem;
margin: 1rem 0;
font-style: italic;
}

@media (max-width: 768px) {
.article-content {
font-size: 0.95rem;
}

.article-content h2 {
font-size: 1.3rem;
}

.article-content h3 {
font-size: 1.1rem;
}
}

.mobile-menu {
transition: all 0.3s ease;
}

.article-card {
transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.article-card:hover {
transform: translateY(-2px);
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.modal {
backdrop-filter: blur(4px);
}

.search-container {
position: relative;
}

.search-results {
position: absolute;
top: 100%;
left: 0;
right: 0;
background: white;
border: 1px solid #e2e8f0;
border-radius: 0.5rem;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
max-height: 400px;
overflow-y: auto;
z-index: 50;
}

.badge {
display: inline-block;
padding: 0.25rem 0.75rem;
border-radius: 9999px;
font-size: 0.75rem;
font-weight: 600;
margin-right: 0.5rem;
margin-bottom: 0.25rem;
}

.badge-blue { background: #ebf8ff; color: #2b6cb0; }
.badge-green { background: #f0fff4; color: #2f855a; }
.badge-red { background: #fff5f5; color: #c53030; }
.badge-purple { background: #faf5ff; color: #6b46c1; }
.badge-yellow { background: #fffaf0; color: #b7791f; }

.pdf-content {
display: none;
}

.article-image {
height: 200px;
background-size: cover;
background-position: center;
border-radius: 8px 8px 0 0;
}

.featured-article-image {
width: 100%;
height: 200px;
object-fit: cover;
border-radius: 8px 8px 0 0;
}

.logo-container {
display: flex;
align-items: center;
gap: 0.75rem;
}

.logo-image {
height: 40px;
width: auto;
}

.logo-text-container {
display: flex;
flex-direction: column;
align-items: flex-start;
}

.logo-text {
line-height: 1;
margin: 0;
}

.logo-subtitle {
font-size: 0.75rem;
color: #6b7280;
margin: 0;
line-height: 1;
font-weight: 400;
}

@media (max-width: 768px) {
.logo-image {
height: 32px;
}

.logo-text {
font-size: 1rem;
}

.logo-subtitle {
font-size: 0.65rem;
}
}

.dropdown {
position: relative;
}

.dropdown-content {
display: none;
position: absolute;
top: 100%;
right: 0;
background-color: white;
min-width: 160px;
box-shadow: 0 8px 16px rgba(0,0,0,0.1);
border-radius: 0.5rem;
z-index: 1000;
border: 1px solid #e2e8f0;
}

.dropdown:hover .dropdown-content {
display: block;
}

.dropdown-content a {
color: #374151;
padding: 12px 16px;
text-decoration: none;
display: block;
transition: background-color 0.2s;
}

.dropdown-content a:hover {
background-color: #f3f4f6;
}

.dropdown-content a:first-child {
border-radius: 0.5rem 0.5rem 0 0;
}

.dropdown-content a:last-child {
border-radius: 0 0 0.5rem 0.5rem;
}

.current-issue-card {
transition: all 0.3s ease;
}

.current-issue-card:hover {
transform: translateY(-2px);
box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.journal-cover-container {
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

@media (max-width: 1024px) {
.journal-cover-container {
background: #f8fafc;
}
}

/* Current Issue Image Styles - Exactly matching index.html */
.current-issue-image-container {
    width: 100%;
    height: 280px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.current-issue-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Mobile Responsive - Exactly matching index.html */
@media (max-width: 1024px) {
    .current-issue-image-container {
        height: 200px;
    }
}

.nav-right {
    margin-left: auto;
}

/* Enhanced Search Styles */
.search-icon {
    color: #2563eb;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0.5rem;
    border-radius: 0.375rem;
}

.search-icon:hover {
    color: #1d4ed8;
    background-color: #f3f4f6;
}

.navbar-search-container {
    position: relative;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}

.navbar-search-input {
    width: 0;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0;
    border: none;
    outline: none;
    background: transparent;
    font-size: 0.875rem;
}

.navbar-search-input.expanded {
    width: 280px;
    opacity: 1;
    padding: 0.75rem 1rem;
    border: 2px solid #3b82f6;
    border-radius: 0.5rem;
    background: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.navbar-search-results {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    max-height: 350px;
    overflow-y: auto;
    z-index: 1000;
}

/* Mobile Search Enhancements */
.mobile-nav-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.mobile-search-container {
    position: relative;
    display: flex;
    align-items: center;
}

.mobile-search-input {
    width: 0;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0;
    border: none;
    outline: none;
    background: transparent;
    position: absolute;
    right: 40px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.875rem;
}

.mobile-search-input.expanded {
    width: 200px;
    opacity: 1;
    padding: 0.625rem 0.875rem;
    border: 2px solid #3b82f6;
    border-radius: 0.5rem;
    background: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    position: relative;
    right: 0;
    top: 0;
    transform: none;
}

.mobile-search-results {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    left: -120px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
}

/* Responsive Search Adjustments */
@media (max-width: 1200px) {
    .navbar-search-input.expanded {
        width: 240px;
    }
}

@media (max-width: 768px) {
    .mobile-search-input.expanded {
        width: 180px;
    }
    
    .mobile-search-results {
        left: -100px;
    }
}

@media (max-width: 640px) {
    .mobile-search-input.expanded {
        width: 160px;
    }
    
    .mobile-search-results {
        left: -80px;
    }
}

@media (max-width: 480px) {
    .mobile-search-input.expanded {
        width: 140px;
    }
    
    .mobile-search-results {
        left: -60px;
    }
}

/* Hide navigation items when search is expanded */
.nav-items.hidden-for-search {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

/* Search Results Styling */
.search-result-item {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.search-result-item:hover {
    background-color: #f8fafc;
}

.search-result-item:last-child {
    border-bottom: none;
    border-radius: 0 0 0.5rem 0.5rem;
}

.search-result-item:first-child {
    border-radius: 0.5rem 0.5rem 0 0;
}

/* Mobile Menu Button Enhancement */
.mobile-menu-btn {
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.mobile-menu-btn:hover {
    background-color: #f3f4f6;
}

/* Updated Hero and About/Call for Papers Layout */
.hero-about-container {
    display: flex;
    flex-direction: column;
}

/* Updated Hero Section with Banner Background - Same Dimensions as Original */
.hero-section {
    color: white;
    padding: 2rem 0;
    min-height: 25vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

/* Desktop Banner Background */
.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('https://dqdhiu.netlify.app/desktop-banner.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: -2;
}

/* Optional overlay for better text readability */
.hero-section::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  /*  background: rgba(30, 58, 138, 0.6);  */
    z-index: -1;
}

/* Enhanced text positioning for banner */
.hero-content {
    position: relative;
    z-index: 1;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

@media (max-width: 1024px) {
    .hero-section {
        padding: 1rem 0;
        min-height: 12vh;
    }
}

@media (max-width: 768px) {
    .hero-section {
        padding: 1.5rem 0;
        min-height: 18vh;
    }
    
    .hero-section::before {
        background-image: url('https://dqdhiu.netlify.app/mobile-banner.jpg');
    }
    
    .hero-section h2 {
        font-size: 2rem !important;
    }
    
    .hero-section p {
        font-size: 1rem !important;
    }
}

/* Loading Spinner Styles */
.loading-spinner {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
    flex-direction: column;
}

.spinner {
    border: 4px solid #f3f4f6;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    color: #6b7280;
    font-size: 1rem;
}

/* Error State Styles */
.error-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #6b7280;
}

.error-icon {
    font-size: 3rem;
    color: #ef4444;
    margin-bottom: 1rem;
}

.retry-btn {
    background: #3b82f6;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s;
    margin-top: 1rem;
}

.retry-btn:hover {
    background: #2563eb;
}

/* Debug info styles */
.debug-info {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 1rem;
    margin: 1rem 0;
    font-family: monospace;
    font-size: 0.875rem;
    color: #495057;
}

.debug-info.error {
    background: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
}

.debug-info.success {
    background: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
}
        
/* Enhanced Responsive Typography */
@media (max-width: 768px) {
    .logo-text {
        font-size: 0.9rem;
    }
    
    .logo-subtitle {
        font-size: 0.6rem;
    }
}

@media (max-width: 480px) {
    .logo-text {
        font-size: 0.85rem;
    }
    
    .logo-subtitle {
        font-size: 0.55rem;
    }
}
</style>
</head>

<body class="bg-gray-50">
<!-- Navigation -->
<nav class="bg-white shadow-sm sticky top-0 z-40">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center">
<div class="flex-shrink-0">
<div class="logo-container">
<img src="logo.png" alt="Islamic Insight Logo" class="logo-image">
<div class="logo-text-container">
<h1 class="logo-text text-xl font-bold text-black-900 academic-title">
ISLAMIC INSIGHT
</h1>
<p class="logo-subtitle">Journal of Islamic Studies</p>
</div>
</div>
</div>
</div>

<!-- Desktop Navigation - Moved to right -->
<div class="hidden md:block nav-right">
<div class="flex items-center space-x-6">
<!-- Navigation Items -->
<div id="nav-items" class="nav-items flex items-baseline space-x-6">
<a href="index.html" class="text-gray-700 hover:text-blue-900 px-3 py-2 text-sm font-medium transition-colors">Home</a>
<a href="index.html#publications" class="text-gray-700 hover:text-blue-900 px-3 py-2 text-sm font-medium transition-colors">Call For Paper</a>
<a href="index.html#featured" class="text-gray-700 hover:text-blue-900 px-3 py-2 text-sm font-medium transition-colors">Current Issue</a>
<a href="#featured" class="text-gray-700 hover:text-blue-900 px-3 py-2 text-sm font-medium transition-colors">All Issues</a>
<div class="dropdown">
<a href="index.html#about" class="text-gray-700 hover:text-blue-900 px-3 py-2 text-sm font-medium transition-colors">About</a>
<div class="dropdown-content">
<a href="editors.html">Editorial Team</a>
<a href="#contact">Contact</a>
</div>
</div>
</div>

<!-- Search Container -->
<div class="navbar-search-container">
<input
type="text"
id="navbar-search-input"
placeholder="Search articles, authors..."
class="navbar-search-input"
>
<button id="search-toggle-btn" class="search-icon">
<i id="search-icon" class="fas fa-search text-lg"></i>
</button>
<div id="navbar-search-results" class="navbar-search-results hidden"></div>
</div>
</div>
</div>

<!-- Mobile menu button and search - Moved to right -->
<div class="md:hidden nav-right">
    <div class="mobile-nav-container">
        <!-- Mobile Search Container -->
        <div class="mobile-search-container">
            <input
                type="text"
                id="mobile-search-input"
                placeholder="Search..."
                class="mobile-search-input"
            >
            <button id="mobile-search-toggle-btn" class="search-icon">
                <i id="mobile-search-icon" class="fas fa-search text-lg"></i>
            </button>
            <div id="mobile-search-results" class="mobile-search-results hidden"></div>
        </div>
        
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="mobile-menu-btn text-gray-700 hover:text-blue-900 focus:outline-none">
            <i class="fas fa-bars text-lg"></i>
        </button>
    </div>
</div>
</div>
</div>

<!-- Mobile Navigation -->
<div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
<div class="px-2 pt-2 pb-3 space-y-1">
<a href="index.html" class="block px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-900 transition-colors">Home</a>
<a href="index.html#publications" class="block px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-900 transition-colors">Call For Paper</a>
<a href="index.html#featured" class="block px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-900 transition-colors">Current Issue</a>
<a href="#featured" class="block px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-900 transition-colors">All Issues</a>
<a href="index.html#about" class="block px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-900 transition-colors">About</a>
<a href="editors.html" class="block px-3 py-2 pl-6 text-sm font-medium text-gray-600 hover:text-blue-900 transition-colors">Editorial Team</a>
<a href="#contact" class="block px-3 py-2 pl-6 text-sm font-medium text-gray-600 hover:text-blue-900 transition-colors">Contact</a>
</div>
</div>
</nav>

<!-- Updated Home Section with Banner Background -->
<section id="home" class="hero-about-container">
    <!-- Hero Section - Now with Banner Background -->
    <div class="hero-section">
        
    </div>
</section>

<!-- All Issues Section -->
<section id="featured" class="pt-4 pb-12 sm:pt-6 sm:pb-16 lg:pt-8 lg:pb-20 bg-gray-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="text-center mb-8">
<h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold academic-title text-gray-900 mb-4">
All Issues
</h2>
<p class="text-gray-600 max-w-3xl mx-auto">
Explore our complete collection of published journal issues
</p>
</div>

<!-- Debug Information (will be hidden in production) -->
<div id="debug-info" class="debug-info hidden">
    <h4>Debug Information:</h4>
    <div id="debug-content"></div>
</div>

<!-- Issues Grid -->
<div class="space-y-6" id="issues-grid">
    <!-- Loading spinner will be shown here initially -->
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p class="loading-text">Loading journal issues...</p>
    </div>
</div>
</div>
</section>

<!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <div class="logo-container mb-4">
                        <img src="logo.png" alt="Islamic Insight Logo" class="logo-image">
                        <div class="logo-text-container">
                            <h1 class="logo-text text-white">ISLAMIC INSIGHT</h1>
                            <p class="logo-subtitle text-gray-300">Journal of Islamic Studies</p>
                        </div>
                    </div>
                    <p class="text-gray-300 mb-4">
                     <strong> MAILING ADDRESS:</strong><br>Editor, Islamic Insight Journal of Islamic Studies, Darul Huda Islamic <br> University, Chemmad, P.B.NO. 3, Tirurangadi (PO), Malappuram (Dt.),<br>676306 (PIN), Kerala, India.<br><br>Email: islamicinsight@dhiu.in <br><br>Website: www.islamicinsight.in
                    </p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#about" class="text-gray-300 hover:text-white transition-colors">About Journal</a></li>
                        <li><a href="#editorial" class="text-gray-300 hover:text-white transition-colors">Editorial Board</a></li>
                        <li><a href="#guidelines" class="text-gray-300 hover:text-white transition-colors">Submission Guidelines</a></li>
                        <li><a href="#contact" class="text-gray-300 hover:text-white transition-colors">Contact Us</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-4">Connect</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">
                            <i class="fab fa-facebook text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">
                            <i class="fab fa-linkedin text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">
                            <i class="fas fa-envelope text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-300">
                <p>&copy; 2024 Islamic Insight Journal. All rights reserved.</p>
            </div>
        </div>
    </footer>

<script>
// ================================
// CONFIGURATION
// ================================
// **IMPORTANT: Replace this with your actual Google Apps Script Web App URL**
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzrTbBUlx41l-zEbOXz1-KSBAGNjFRDvFNIvIgp-H_HiwklyPg6faRXg-MpO2kdDdw1/exec';

// Debug mode (set to false for production)
const DEBUG_MODE = true;

// ================================
// GLOBAL VARIABLES
// ================================
let allIssues = [];
let isDataLoaded = false;
let fetchAttempts = 0;
const MAX_FETCH_ATTEMPTS = 3;

// DOM Elements
const issuesGrid = document.getElementById('issues-grid');
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
const debugInfo = document.getElementById('debug-info');
const debugContent = document.getElementById('debug-content');

// Enhanced search elements
const searchToggleBtn = document.getElementById('search-toggle-btn');
const navbarSearchInput = document.getElementById('navbar-search-input');
const navbarSearchResults = document.getElementById('navbar-search-results');
const searchIcon = document.getElementById('search-icon');
const navItems = document.getElementById('nav-items');

// Mobile search elements
const mobileSearchToggleBtn = document.getElementById('mobile-search-toggle-btn');
const mobileSearchInput = document.getElementById('mobile-search-input');
const mobileSearchResults = document.getElementById('mobile-search-results');
const mobileSearchIcon = document.getElementById('mobile-search-icon');

// Search state tracking
let isDesktopSearchExpanded = false;
let isMobileSearchExpanded = false;

// ================================
// INITIALIZATION
// ================================
document.addEventListener('DOMContentLoaded', function() {
    logDebug('DOM loaded, initializing application...');
    setupEventListeners();
    fetchIssuesFromGoogleSheets();
    
    if (DEBUG_MODE) {
        debugInfo.classList.remove('hidden');
    }
});

// ================================
// DEBUG FUNCTIONS
// ================================
function logDebug(message, data = null) {
    if (DEBUG_MODE) {
        console.log(`[DEBUG] ${message}`, data || '');
        updateDebugInfo(message, data);
    }
}

function logError(message, error = null) {
    console.error(`[ERROR] ${message}`, error || '');
    if (DEBUG_MODE) {
        updateDebugInfo(`ERROR: ${message}`, error, 'error');
    }
}

function updateDebugInfo(message, data = null, type = 'info') {
    if (!DEBUG_MODE || !debugContent) return;
    
    const timestamp = new Date().toLocaleTimeString();
    const debugEntry = document.createElement('div');
    debugEntry.className = `debug-entry ${type}`;
    debugEntry.innerHTML = `
        <strong>[${timestamp}]</strong> ${message}
        ${data ? `<pre>${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}</pre>` : ''}
    `;
    
    debugContent.appendChild(debugEntry);
    debugContent.scrollTop = debugContent.scrollHeight;
    
    // Update debug container class
    debugInfo.className = `debug-info ${type}`;
}

// ================================
// DATA FETCHING AND PROCESSING
// ================================

/**
 * Fetch issues data from Google Sheets via Apps Script with enhanced error handling
 */
async function fetchIssuesFromGoogleSheets() {
    fetchAttempts++;
    logDebug(`Attempting to fetch data (attempt ${fetchAttempts}/${MAX_FETCH_ATTEMPTS})`);
    
    try {
        showLoadingState();
        
        logDebug('Making request to Google Apps Script...', GOOGLE_SCRIPT_URL);
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            },
            signal: controller.signal,
            mode: 'cors',
            cache: 'no-cache'
        });

        clearTimeout(timeoutId);
        
        logDebug('Response received', {
            status: response.status,
            statusText: response.statusText,
            headers: Array.from(response.headers.entries())
        });

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        let result;
        const contentType = response.headers.get('content-type');
        
        if (contentType && contentType.includes('application/json')) {
            result = await response.json();
        } else {
            const text = await response.text();
            logDebug('Received non-JSON response', text.substring(0, 500));
            throw new Error('Invalid response format: Expected JSON but received text');
        }
        
        logDebug('Parsed response', result);
        
        if (result.status === 'error') {
            throw new Error(result.message || 'Unknown error from Google Apps Script');
        }

        if (!result.data || !Array.isArray(result.data)) {
            throw new Error('Invalid data format: Expected array of issues');
        }

        // Transform the data
        allIssues = transformGoogleSheetsData(result.data);
        isDataLoaded = true;
        
        logDebug(`Successfully processed ${allIssues.length} issues`);
        
        // Render the issues
        renderAllIssues();
        
        // Reset fetch attempts on success
        fetchAttempts = 0;
        
    } catch (error) {
        logError('Failed to fetch data from Google Sheets', error);
        
        if (fetchAttempts < MAX_FETCH_ATTEMPTS) {
            logDebug(`Retrying in 2 seconds... (${fetchAttempts}/${MAX_FETCH_ATTEMPTS})`);
            setTimeout(() => {
                fetchIssuesFromGoogleSheets();
            }, 2000);
        } else {
            showErrorState(error.message);
        }
    }
}

/**
 * Transform Google Sheets data to the format expected by the frontend
 */
function transformGoogleSheetsData(sheetsData) {
    logDebug('Transforming sheets data', sheetsData);
    
    if (!Array.isArray(sheetsData)) {
        logError('Invalid sheets data: Expected array', sheetsData);
        return [];
    }
    
    const transformed = sheetsData.map((issue, index) => {
        logDebug(`Processing issue ${index + 1}`, issue);
        
        // Ensure required fields have defaults
        const safeIssue = {
            issue_id: issue.issue_id || `temp_${index}`,
            volume: issue.volume || '1',
            number: issue.number || '1',
            year: issue.year || new Date().getFullYear().toString(),
            issue_title: issue.issue_title || `Volume ${issue.volume} No. ${issue.number}`,
            issue_abstract: issue.issue_abstract || 'No abstract available for this issue.',
            issue_published_date: issue.issue_published_date || new Date().toISOString().split('T')[0],
            issue_cover_image: issue.issue_cover_image || 'https://dqdhiu.netlify.app/default-cover.jpg',
            redirectUrl: issue.redirectUrl || '#',
            articles: issue.articles || []
        };
        
        // Determine categories based on issue data
        const categories = [];
        const currentYear = new Date().getFullYear();
        const issueYear = parseInt(safeIssue.year) || currentYear;
        
        if (issueYear === currentYear) {
            categories.push('Latest');
        }
        if (issueYear < currentYear) {
            categories.push('Previous');
        }
        if (safeIssue.number === '1') {
            categories.push('First Issue');
        }
        if (categories.length === 0) {
            categories.push('Published');
        }

        // Extract keywords from the first article if available
        let keywords = [];
        if (safeIssue.articles && safeIssue.articles.length > 0 && safeIssue.articles[0].keywords) {
            keywords = safeIssue.articles[0].keywords.split(',').map(k => k.trim()).slice(0, 3);
        }
        if (keywords.length === 0) {
            keywords = ['Islamic Studies', 'Academic Research', 'Peer Review'];
        }

        return {
            id: parseInt(safeIssue.issue_id) || index,
            title: safeIssue.issue_title,
            authors: '', // Issues typically don't have authors, articles do
            journal: 'Islamic Insight',
            date: safeIssue.issue_published_date,
            volume: safeIssue.volume,
            pages: '', // Pages are typically at article level
            doi: '', // DOI is typically at article level
            categories: categories,
            abstract: safeIssue.issue_abstract,
            keywords: keywords,
            imageUrl: safeIssue.issue_cover_image,
            redirectUrl: safeIssue.redirectUrl,
            articles: safeIssue.articles,
            year: safeIssue.year,
            number: safeIssue.number
        };
    });

    // Sort by year and number (most recent first)
    const sorted = transformed.sort((a, b) => {
        const yearDiff = parseInt(b.year) - parseInt(a.year);
        if (yearDiff !== 0) return yearDiff;
        return parseInt(b.number) - parseInt(a.number);
    });
    
    logDebug('Transformation complete', sorted);
    return sorted;
}

// ================================
// UI RENDERING FUNCTIONS
// ================================

/**
 * Show loading state
 */
function showLoadingState() {
    issuesGrid.innerHTML = `
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="loading-text">Loading journal issues from database...</p>
            ${DEBUG_MODE ? `<p class="text-xs text-gray-500 mt-2">Attempt ${fetchAttempts}/${MAX_FETCH_ATTEMPTS}</p>` : ''}
        </div>
    `;
}

/**
 * Show error state with retry option
 */
function showErrorState(errorMessage = 'Failed to load journal issues') {
    logError('Showing error state', errorMessage);
    
    issuesGrid.innerHTML = `
        <div class="error-state">
            <i class="fas fa-exclamation-triangle error-icon"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Unable to Load Issues</h3>
            <p class="text-gray-600 mb-4">${errorMessage}</p>
            <p class="text-sm text-gray-500 mb-4">Please check your internet connection and try again.</p>
            ${DEBUG_MODE ? `
                <div class="debug-info error mb-4">
                    <p><strong>Debug Info:</strong></p>
                    <p>Attempts: ${fetchAttempts}/${MAX_FETCH_ATTEMPTS}</p>
                    <p>Google Script URL: ${GOOGLE_SCRIPT_URL}</p>
                    <p>Error: ${errorMessage}</p>
                </div>
            ` : ''}
            <button onclick="retryDataFetch()" class="retry-btn">
                <i class="fas fa-redo mr-2"></i>
                Retry Loading
            </button>
        </div>
    `;
}

/**
 * Retry data fetching
 */
function retryDataFetch() {
    logDebug('Manual retry triggered');
    fetchAttempts = 0;
    fetchIssuesFromGoogleSheets();
}

/**
 * Render all issues in the grid
 */
function renderAllIssues() {
    logDebug('Rendering all issues', `${allIssues.length} issues`);
    
    if (!isDataLoaded || allIssues.length === 0) {
        issuesGrid.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-book-open text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">No Issues Available</h3>
                <p class="text-gray-600">Journal issues will appear here once they are published.</p>
                ${DEBUG_MODE ? `
                    <div class="debug-info mt-4">
                        <p>Data loaded: ${isDataLoaded}</p>
                        <p>Issues count: ${allIssues.length}</p>
                    </div>
                ` : ''}
            </div>
        `;
        return;
    }
    
    issuesGrid.innerHTML = '';
    
    allIssues.forEach((issue, index) => {
        logDebug(`Rendering issue ${index + 1}`, issue.title);
        const issueCard = createIssueCard(issue);
        issuesGrid.appendChild(issueCard);
    });
    
    logDebug('All issues rendered successfully');
}

/**
 * Create an issue card element
 */
function createIssueCard(issue) {
    const div = document.createElement('div');
    div.className = 'bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden current-issue-card';
    
    const badgeColors = ['badge-blue', 'badge-green', 'badge-red', 'badge-purple', 'badge-yellow'];
    const categoryBadges = issue.categories.map((category, index) => 
        `<span class="badge ${badgeColors[index % badgeColors.length]}">${category}</span>`
    ).join('');
    
    // Format date for display
    const displayDate = formatDate(issue.date);
    
    // Create articles summary
    const articlesText = issue.articles && issue.articles.length > 0 
        ? `${issue.articles.length} article${issue.articles.length > 1 ? 's' : ''} published`
        : 'View issue details';
    
    div.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-0">
            <!-- Journal cover - Left side -->
            <div class="lg:col-span-1 p-2 flex justify-center items-center bg-gray-50">
                <div class="current-issue-image-container">
                    <img src="${issue.imageUrl}" 
                         alt="${issue.title}" 
                         class="current-issue-image"
                         onerror="this.src='https://dqdhiu.netlify.app/default-cover.jpg'; console.log('Image failed to load:', '${issue.imageUrl}');">
                </div>
            </div>

            <!-- Content - Right side -->
            <div class="lg:col-span-2 p-6">
                <div class="mb-4">
                    ${categoryBadges}
                </div>
                
                <h3 class="text-xl sm:text-2xl font-semibold academic-title text-gray-900 mb-4">
                    ${issue.title}
                </h3>

                <p class="text-gray-700 mb-6 leading-relaxed text-justify">
                    ${issue.abstract}
                </p>

                <div class="mb-6 space-y-2">
                    <p class="text-sm text-gray-600">
                        <i class="far fa-calendar-alt mr-2"></i><strong>Published:</strong> ${displayDate}
                    </p>
                    <p class="text-sm text-gray-600">
                        <i class="fas fa-book mr-2"></i><strong>Volume:</strong> ${issue.volume} No. ${issue.number} (${issue.year})
                    </p>
                    ${issue.articles && issue.articles.length > 0 ? `
                    <p class="text-sm text-gray-600">
                        <i class="far fa-file-alt mr-2"></i><strong>Articles:</strong> ${articlesText}
                    </p>
                    ` : ''}
                </div>

                <div class="flex justify-between items-center">
                    <button 
                        onclick="redirectToIssue('${issue.redirectUrl}')" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        View Articles <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                    
                    ${issue.articles && issue.articles.length > 0 ? `
                    <button 
                        onclick="showIssueDetails(${issue.id})" 
                        class="text-blue-600 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">
                        <i class="fas fa-info-circle mr-1"></i>
                        Details
                    </button>
                    ` : ''}
                </div>
                
                ${DEBUG_MODE ? `
                    <div class="debug-info mt-4 text-xs">
                        <p><strong>Issue ID:</strong> ${issue.id}</p>
                        <p><strong>Redirect URL:</strong> ${issue.redirectUrl}</p>
                        <p><strong>Articles:</strong> ${issue.articles.length}</p>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
    
    return div;
}

// ================================
// UTILITY FUNCTIONS
// ================================

/**
 * Format date for display
 */
function formatDate(dateString) {
    try {
        if (!dateString) return 'Date not available';
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return dateString; // Return original if parsing fails
        }
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    } catch (error) {
        logError('Date formatting error', error);
        return dateString || 'Invalid date';
    }
}

/**
 * Redirect to specific issue page
 */
function redirectToIssue(url) {
    logDebug('Redirecting to issue', url);
    
    if (url && url !== '#' && url !== '') {
        window.location.href = url;
    } else {
        logError('No valid redirect URL provided', url);
        alert('This issue is not yet available online. Please check back later.');
    }
}

/**
 * Show issue details (placeholder for future implementation)
 */
function showIssueDetails(issueId) {
    const issue = allIssues.find(i => i.id === issueId);
    if (issue) {
        logDebug('Showing issue details', issue);
        
        const articlesInfo = issue.articles.length > 0 
            ? `\nArticles:\n${issue.articles.map(a => `- ${a.article_title} by ${a.author}`).join('\n')}`
            : '\nNo articles available';
            
        alert(`Issue Details:\n\nTitle: ${issue.title}\nVolume: ${issue.volume} No. ${issue.number}\nYear: ${issue.year}\nPublished: ${formatDate(issue.date)}\nArticles: ${issue.articles.length}${articlesInfo}`);
        // TODO: Implement proper modal or detailed view
    } else {
        logError('Issue not found', issueId);
    }
}

// ================================
// EVENT LISTENERS AND INTERACTIONS
// ================================

/**
 * Setup all event listeners
 */
function setupEventListeners() {
    logDebug('Setting up event listeners');
    
    // Mobile menu toggle
    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function() {
            mobileMenu.classList.toggle('hidden');
        });
    }

    // Desktop navbar search functionality
    if (searchToggleBtn) {
        searchToggleBtn.addEventListener('click', toggleNavbarSearch);
    }
    if (navbarSearchInput) {
        navbarSearchInput.addEventListener('input', handleNavbarSearch);
        navbarSearchInput.addEventListener('focus', function() {
            if (navbarSearchInput.value.trim()) {
                navbarSearchResults.classList.remove('hidden');
            }
        });
        navbarSearchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                toggleNavbarSearch();
            }
        });
    }

    // Mobile search functionality
    if (mobileSearchToggleBtn) {
        mobileSearchToggleBtn.addEventListener('click', toggleMobileSearch);
    }
    if (mobileSearchInput) {
        mobileSearchInput.addEventListener('input', handleMobileSearch);
        mobileSearchInput.addEventListener('focus', function() {
            if (mobileSearchInput.value.trim()) {
                mobileSearchResults.classList.remove('hidden');
            }
        });
        mobileSearchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                toggleMobileSearch();
            }
        });
    }

    // Close search results when clicking outside
    document.addEventListener('click', function(e) {
        // Desktop search
        if (navbarSearchInput && navbarSearchResults && searchToggleBtn &&
            !navbarSearchInput.contains(e.target) && 
            !navbarSearchResults.contains(e.target) && 
            !searchToggleBtn.contains(e.target)) {
            navbarSearchResults.classList.add('hidden');
        }

        // Mobile search
        if (mobileSearchInput && mobileSearchResults && mobileSearchToggleBtn &&
            !mobileSearchInput.contains(e.target) && 
            !mobileSearchResults.contains(e.target) && 
            !mobileSearchToggleBtn.contains(e.target)) {
            mobileSearchResults.classList.add('hidden');
        }
    });

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                // Close mobile menu if open
                if (mobileMenu) {
                    mobileMenu.classList.add('hidden');
                }
            }
        });
    });
    
    logDebug('Event listeners setup complete');
}

// ================================
// SEARCH FUNCTIONALITY
// ================================

/**
 * Toggle navbar search with better state management
 */
function toggleNavbarSearch() {
    isDesktopSearchExpanded = !isDesktopSearchExpanded;

    if (isDesktopSearchExpanded) {
        // Expand search
        navbarSearchInput.classList.add('expanded');
        navItems.classList.add('hidden-for-search');
        searchIcon.className = 'fas fa-times text-lg';
        navbarSearchInput.focus();
    } else {
        // Collapse search
        navbarSearchInput.classList.remove('expanded');
        navItems.classList.remove('hidden-for-search');
        searchIcon.className = 'fas fa-search text-lg';
        navbarSearchResults.classList.add('hidden');
        navbarSearchInput.value = '';
    }
}

/**
 * Toggle mobile search with proper cross functionality
 */
function toggleMobileSearch() {
    isMobileSearchExpanded = !isMobileSearchExpanded;

    if (isMobileSearchExpanded) {
        // Expand search
        mobileSearchInput.classList.add('expanded');
        mobileSearchIcon.className = 'fas fa-times text-lg';
        mobileSearchInput.focus();
    } else {
        // Collapse search
        mobileSearchInput.classList.remove('expanded');
        mobileSearchIcon.className = 'fas fa-search text-lg';
        mobileSearchResults.classList.add('hidden');
        mobileSearchInput.value = '';
    }
}

/**
 * Handle navbar search with improved filtering
 */
function handleNavbarSearch() {
    const query = navbarSearchInput.value.toLowerCase().trim();

    if (!query) {
        navbarSearchResults.classList.add('hidden');
        return;
    }

    const filteredIssues = searchIssues(query);
    displayNavbarSearchResults(filteredIssues, query);
}

/**
 * Handle mobile search with improved filtering
 */
function handleMobileSearch() {
    const query = mobileSearchInput.value.toLowerCase().trim();

    if (!query) {
        mobileSearchResults.classList.add('hidden');
        return;
    }

    const filteredIssues = searchIssues(query);
    displayMobileSearchResults(filteredIssues, query);
}

/**
 * Search issues based on query
 */
function searchIssues(query) {
    if (!isDataLoaded || allIssues.length === 0) {
        return [];
    }

    return allIssues.filter(issue => {
        return issue.title.toLowerCase().includes(query) ||
            issue.abstract.toLowerCase().includes(query) ||
            issue.keywords.some(keyword => keyword.toLowerCase().includes(query)) ||
            issue.categories.some(category => category.toLowerCase().includes(query)) ||
            issue.volume.toLowerCase().includes(query) ||
            issue.year.toString().includes(query) ||
            (issue.articles && issue.articles.some(article => 
                (article.article_title && article.article_title.toLowerCase().includes(query)) ||
                (article.author && article.author.toLowerCase().includes(query)) ||
                (article.abstract && article.abstract.toLowerCase().includes(query))
            ));
    });
}

/**
 * Display navbar search results with redirect functionality
 */
function displayNavbarSearchResults(results, query) {
    if (!isDataLoaded) {
        navbarSearchResults.innerHTML = `
            <div class="p-4 text-center text-gray-500">
                <i class="fas fa-spinner fa-spin text-2xl mb-2 text-gray-400"></i>
                <p>Loading search data...</p>
            </div>
        `;
    } else if (results.length === 0) {
        navbarSearchResults.innerHTML = `
            <div class="p-4 text-center text-gray-500">
                <i class="fas fa-search text-2xl mb-2 text-gray-400"></i>
                <p>No issues found for "<strong>${query}</strong>"</p>
            </div>
        `;
    } else {
        navbarSearchResults.innerHTML = results.map(issue => `
            <div class="search-result-item" onclick="redirectToIssue('${issue.redirectUrl}'); toggleNavbarSearch();">
                <h4 class="font-semibold text-gray-900 mb-1 text-sm">${highlightSearchTerm(issue.title, query)}</h4>
                <p class="text-xs text-gray-500 mb-2">Volume ${issue.volume} No. ${issue.number} • ${formatDate(issue.date)}</p>
                <p class="text-xs text-gray-500">${highlightSearchTerm(issue.abstract.substring(0, 120), query)}...</p>
                <div class="flex flex-wrap gap-1 mt-2">
                    ${issue.categories.slice(0, 2).map(cat => `<span class="badge badge-blue text-xs">${cat}</span>`).join('')}
                </div>
            </div>
        `).join('');
    }

    navbarSearchResults.classList.remove('hidden');
}

/**
 * Display mobile search results with redirect functionality
 */
function displayMobileSearchResults(results, query) {
    if (!isDataLoaded) {
        mobileSearchResults.innerHTML = `
            <div class="p-3 text-center text-gray-500 text-sm">
                <i class="fas fa-spinner fa-spin text-lg mb-1 text-gray-400"></i>
                <p>Loading search data...</p>
            </div>
        `;
    } else if (results.length === 0) {
        mobileSearchResults.innerHTML = `
            <div class="p-3 text-center text-gray-500 text-sm">
                <i class="fas fa-search text-lg mb-1 text-gray-400"></i>
                <p>No issues found for "<strong>${query}</strong>"</p>
            </div>
        `;
    } else {
        mobileSearchResults.innerHTML = results.map(issue => `
            <div class="search-result-item text-sm" onclick="redirectToIssue('${issue.redirectUrl}'); toggleMobileSearch();">
                <h4 class="font-semibold text-gray-900 mb-1">${highlightSearchTerm(issue.title, query)}</h4>
                <p class="text-xs text-gray-600 mb-1">Volume ${issue.volume} No. ${issue.number} • ${formatDate(issue.date)}</p>
                <p class="text-xs text-gray-500">${highlightSearchTerm(issue.abstract.substring(0, 100), query)}...</p>
                <div class="flex flex-wrap gap-1 mt-1">
                    ${issue.categories.slice(0, 2).map(cat => `<span class="badge badge-blue text-xs">${cat}</span>`).join('')}
                </div>
            </div>
        `).join('');
    }

    mobileSearchResults.classList.remove('hidden');
}

/**
 * Highlight search terms in results
 */
function highlightSearchTerm(text, query) {
    if (!query || !text) return text;
    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
    return text.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
}

// ================================
// GLOBAL ERROR HANDLER
// ================================
window.addEventListener('error', function(e) {
    logError('Global error caught', {
        message: e.message,
        filename: e.filename,
        lineno: e.lineno,
        colno: e.colno,
        error: e.error
    });
});

window.addEventListener('unhandledrejection', function(e) {
    logError('Unhandled promise rejection', e.reason);
});
</script>

</body>
</html>
